<script>
    document.addEventListener('DOMContentLoaded', function () {

        document.getElementById("btn").addEventListener("click", buttonClickAction);

        let paymentDate = document.getElementById('payment_date');

        M.Datepicker.init(paymentDate, {
            autoClose: true,
            format: 'yyyy-mm-dd',
        });

        let tenantName = document.getElementById('tenant_name');

        M.FormSelect.init(tenantName);



    });


    function buttonClickAction() {

        let toValidate = {

            tenant_name: "입주자를 입력하세요.",
            payment_date: "입금일을 입력하세요.",
            amount: "입금액을 입력하세요.",

        };

        let idKeys = Object.keys(toValidate);
        let allValid = true;

        idKeys.forEach(function (id) {
            let isValid = checkIfValid(id, toValidate[id]);
            if (!isValid) {
                allValid = false;
            };
        })

        if (allValid) {
            addPayment();
        };

        function checkIfValid(elId, message) {

            let isValid = document.getElementById(elId).checkValidity();
            
            if (isValid) {
                return true;
            } else {
                M.toast({
                    html: message
                });
                return false;
            };

        };

    }


    function addPayment() {

        let paymentInfo = {};

        paymentInfo.tenantName = document.getElementById("tenant_name").value;
        paymentInfo.paymentDate = document.getElementById("payment_date").value;
        paymentInfo.amount = document.getElementById("amount").value;
        paymentInfo.memo = document.getElementById("payment_memo").value;

        google.script.run.submitPayment(paymentInfo);

        document.getElementById("tenant_name").value = "";
        document.getElementById("payment_date").value = "";
        document.getElementById("amount").value = "";
        document.getElementById("payment_memo").value = "";
        M.updateTextFields();

    }
</script>